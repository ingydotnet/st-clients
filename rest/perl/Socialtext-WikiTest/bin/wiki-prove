#!/usr/bin/perl
use strict;
use warnings;
use Socialtext::Resting::Getopt qw/get_rester/;
use Socialtext::WikiObject::TestPlan;
use Getopt::Long;
use Sys::Hostname qw/hostname/;
use Test::More;
use lib 'lib';

my $base_url = "http://" . hostname();
my $file;
GetOptions(
    'base-url=s' => \$base_url,
    'f|file=s'     => \$file,
) or usage();

my $page = shift;

my $rester = get_rester();
if ($file) {
    require Socialtext::Resting::Mock;
    $rester = Socialtext::Resting::Mock->new(file => $file);
    $page = $file;
}
my $test_plan = Socialtext::WikiObject::TestPlan->new(
    rester => $rester,
    page => $page,
    default_fixture => 'HTTP',
    fixture_args => {
        base_url => $base_url,
    },
);
$test_plan->run_tests;

done_testing();

exit;

sub usage {
    die <<EOT;
USAGE: wiki-prv [--base-url=http://yourhost] [rester opts] 'Page Name'

See `perldoc Socialtext::Resting::Getopt` for details on rester opts.
EOT
}
